<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso Interno | Tendencia Legal</title>
    <link rel="icon" type="image/png" href="pilar.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            margin: 0; padding: 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #f4f4f4; display: flex; justify-content: center; align-items: center;
            height: 100vh;
            background-image: linear-gradient(rgba(22, 47, 69, 0.95), rgba(22, 47, 69, 0.9)), url('logo.png');
            background-size: cover; background-position: center;
        }
        .login-container {
            background: white; padding: 40px; border-radius: 8px;
            box-shadow: 0 15px 25px rgba(0,0,0,0.5); width: 100%; max-width: 380px;
            text-align: center; border-top: 5px solid #B68656;
        }
        .login-logo { width: 100px; margin-bottom: 20px; }
        .login-container h2 { color: #162F45; margin-bottom: 5px; font-family: 'Times New Roman', serif; font-size: 24px; }
        .login-container p { color: #888; font-size: 13px; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 1px; }
        .input-group { position: relative; margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; margin-bottom: 5px; color: #162F45; font-size: 13px; font-weight: bold; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 15px; color: #333; }
        .input-group input:focus { border-color: #B68656; outline: none; box-shadow: 0 0 5px rgba(182, 134, 86, 0.3); }
        .btn-login { width: 100%; padding: 12px; background-color: #162F45; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; transition: background 0.3s; font-weight: bold; }
        .btn-login:hover { background-color: #B68656; }
        .btn-login:disabled { background-color: #ccc; cursor: not-allowed; }
        .footer-login { margin-top: 25px; font-size: 12px; color: #aaa; border-top: 1px solid #eee; padding-top: 15px; }
        .error-msg { color: #c62828; font-size: 13px; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <div class="login-container">
        <img src="logo.png" alt="Logo Tendencia Legal" class="login-logo">
        <h2>Tendencia Legal</h2>
        <p>Sistema de Gestión Interna</p>

        <form id="loginForm">
            <div class="input-group">
                <label for="email">Correo Corporativo</label>
                <input type="email" id="email" placeholder="usuario@tendencialegal.com" required>
            </div>
            
            <div class="input-group">
                <label for="password">Contraseña</label>
                <input type="password" id="password" placeholder="••••••••" required>
            </div>

            <button type="submit" class="btn-login" id="btnIngresar">Ingresar</button>
            <p class="error-msg" id="errorMsg">Credenciales incorrectas</p>
        </form>

        <div class="footer-login">
            <a href="index.html" style="color: #666; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 5px;">
                <i class="fas fa-arrow-left"></i> Volver a la página web
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // 1. CONEXIÓN
        const supabaseUrl = 'https://gpwrnhynvyerranktstf.supabase.co';
        const supabaseKey = 'sb_publishable_XsLhiovLphmecmnjHAmYDQ_MEIaARRZ';
        const clienteSupabase = supabase.createClient(supabaseUrl, supabaseKey);

        const loginForm = document.getElementById('loginForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const errorMsg = document.getElementById('errorMsg');
        const btnIngresar = document.getElementById('btnIngresar');

        // 2. VERIFICAR SI YA ESTÁ LOGUEADO
        async function checkSession() {
            const { data: { session } } = await clienteSupabase.auth.getSession();
            if (session) {
                window.location.href = "panel-interno.html";
            }
        }
        checkSession();

        // 3. PROCESO DE LOGIN
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // UI de carga
            btnIngresar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
            btnIngresar.disabled = true;
            errorMsg.style.display = 'none';

            const email = emailInput.value;
            const password = passwordInput.value;

            // Intentar loguear con Supabase
            const { data, error } = await clienteSupabase.auth.signInWithPassword({
                email: email,
                password: password
            });

            if (error) {
                console.error("Error login:", error.message);
                errorMsg.innerText = "Usuario o contraseña incorrectos.";
                errorMsg.style.display = "block";
                passwordInput.style.border = "1px solid #c62828";
                btnIngresar.innerHTML = 'Ingresar';
                btnIngresar.disabled = false;
            } else {
                // Éxito
                window.location.href = "panel-interno.html";
            }
        });
    </script>

</body>
</html>
